<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deelnemerselectie</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px; }
    label { display: block; margin: 10px 0; }
    input[type="text"], input[type="email"] { width: 100%; padding: 8px; }
    .checkboxes label { margin: 4px 0; }
    .error { color: red; }
    button { padding: 10px 15px; margin-top: 15px; }
    table { width: 100%; border-collapse: collapse; margin-top: 40px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>
  <h1>Deelnemerselectie</h1>

  <form id="selectieForm" action="/submit" method="POST">
    <label>
      Voornaam:
      <input type="text" name="voornaam" required />
    </label>
    <label>
      Achternaam:
      <input type="text" name="achternaam" required />
    </label>
    <label>
      E-mailadres:
      <input type="email" name="email" required />
    </label>

    <fieldset>
      <legend>Selecteer maximaal 10 deelnemers:</legend>
      <div class="checkboxes">
        <label><input type="checkbox" name="deelnemers" value="Deelnemer 1"> Deelnemer 1</label>
        <label><input type="checkbox" name="deelnemers" value="Deelnemer 2"> Deelnemer 2</label>
        <label><input type="checkbox" name="deelnemers" value="Deelnemer 3"> Deelnemer 3</label>
        <label><input type="checkbox" name="deelnemers" value="Deelnemer 4"> Deelnemer 4</label>
        <label><input type="checkbox" name="deelnemers" value="Deelnemer 5"> Deelnemer 5</label>
        <label><input type="checkbox" name="deelnemers" value="Deelnemer 6"> Deelnemer 6</label>
        <label><input type="checkbox" name="deelnemers" value="Deelnemer 7"> Deelnemer 7</label>
        <label><input type="checkbox" name="deelnemers" value="Deelnemer 8"> Deelnemer 8</label>
        <label><input type="checkbox" name="deelnemers" value="Deelnemer 9"> Deelnemer 9</label>
        <label><input type="checkbox" name="deelnemers" value="Deelnemer 10"> Deelnemer 10</label>
        <label><input type="checkbox" name="deelnemers" value="Deelnemer 11"> Deelnemer 11</label>
        <label><input type="checkbox" name="deelnemers" value="Deelnemer 12"> Deelnemer 12</label>
      </div>
    </fieldset>

    <p class="error" id="errorMessage"></p>

    <button type="submit">Verstuur selectie</button>
  </form>

  <hr>

  <h2>Inzendingen</h2>
  <button onclick="downloadCSV()">Download als CSV</button>
  <table id="inzendingenTabel">
    <thead>
      <tr>
        <th>Voornaam</th>
        <th>Achternaam</th>
        <th>E-mail</th>
        <th>Deelnemers</th>
        <th>Tijdstip</th>
      </tr>
    </thead>
    <tbody id="tabelBody">
    </tbody>
  </table>

  <script>
    // Validatie formulier
    const form = document.getElementById("selectieForm");
    const errorMessage = document.getElementById("errorMessage");

    form.addEventListener("submit", function (e) {
      const geselecteerd = document.querySelectorAll('input[name="deelnemers"]:checked');
      if (geselecteerd.length > 10) {
        errorMessage.textContent = "Je mag maximaal 10 deelnemers selecteren.";
        e.preventDefault();
      } else if (geselecteerd.length === 0) {
        errorMessage.textContent = "Selecteer ten minste 1 deelnemer.";
        e.preventDefault();
      } else {
        errorMessage.textContent = "";
      }
    });

    // Ophalen inzendingen en tonen in tabel
    async function haalInzendingenOp() {
      const res = await fetch('/inzendingen');
      const data = await res.json();
      const tbody = document.getElementById('tabelBody');
      tbody.innerHTML = '';
      data.forEach(rij => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${rij.voornaam}</td>
          <td>${rij.achternaam}</td>
          <td>${rij.email}</td>
          <td>${rij.deelnemers}</td>
          <td>${new Date(rij.tijdstip).toLocaleString()}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Download CSV
    async function downloadCSV() {
      const res = await fetch('/inzendingen');
      const data = await res.json();
      const csv = [
        ['Voornaam', 'Achternaam', 'E-mail', 'Deelnemers', 'Tijdstip'],
        ...data.map(r => [r.voornaam, r.achternaam, r.email, r.deelnemers, r.tijdstip])
      ].map(row => row.map(item => `"${item}"`).join(',')).join('\n');

      const blob = new Blob([csv], { type: 'text/csv' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'inzendingen.csv';
      link.click();
    }

    // Laad gegevens bij opstart
    haalInzendingenOp();
  </script>
</body>
</html>
